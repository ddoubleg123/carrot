<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Community Chat â€” Techpulse</title>
  <link rel="stylesheet" href="./chat.css" />
  <style>
    :root { --ink:#0B0B0F; --surface:#111318; --line:#1F2329; --accent:#0A5AFF; }
    body { margin:0; background: var(--ink); color:#fff; }
    .flex { display:flex; }
    .sidebar { position: sticky; top:0; height:100dvh; display:none; flex-direction:column; border-right:1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.02); backdrop-filter: blur(6px); }
    @media (min-width: 768px){ .sidebar { display:flex; width: 18rem; } }
    .navwrap { padding: 8px; }
    .navlist { list-style:none; padding:0; margin:0; display:flex; flex-direction:column; gap:4px; }
    .nav a { position:relative; display:grid; grid-template-columns: 24px 1fr; align-items:center; gap:12px; border-radius: 12px; padding: 8px 12px; text-decoration:none; color: rgba(255,255,255,0.8); }
    .nav a:hover, .nav a:focus-visible { background: rgba(255,255,255,0.06); outline:none; box-shadow: 0 0 0 2px rgba(10,90,255,0.45); color:#fff; }
    .nav a[aria-current="page"] { background: rgba(255,255,255,0.08); color:#fff; box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1); }
    .ico { pointer-events:none; display:grid; place-items:center; height:20px; width:20px; }
    .nav svg { width:20px; height:20px; color: rgba(255,255,255,0.6); }
    .nav a[aria-current="page"] .activebar { position:absolute; left:0; top:6px; bottom:6px; width:2px; border-radius:999px; background: rgba(10,90,255,0.8); }
    .divider { margin: 12px 12px; height:1px; background: rgba(255,255,255,0.1); }
    .brandbox { width:44px; aspect-ratio:1/1; border-radius:12px; background:#0A5AFF; display:grid; place-items:center; box-shadow: 0 1px 0 rgba(255,255,255,0.06) inset, 0 8px 24px rgba(10,90,255,0.16); }
    .brandrow { display:flex; align-items:center; padding: 12px; padding-bottom: 8px; }
    .brand-item { margin-bottom: 12px; }
    .brandbox svg { width:60%; height:60%; color:#fff; }
    .sb-bottom { margin-top:auto; padding:12px; }
    .profile { border:1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.03); border-radius: 12px; padding: 10px; }
    .row { display:flex; align-items:center; gap:10px; }
    .avatar { height:36px; width:36px; border-radius:999px; background: rgba(255,255,255,0.1); box-shadow: inset 0 0 0 1px rgba(255,255,255,0.1); display:grid; place-items:center; font-weight:700; color:#fff; }
    .email { color: rgba(255,255,255,0.6); font-size:12px; }
    .btns { display:flex; gap:8px; margin-top:8px; }
    .btn { flex:1; border-radius: 10px; border:1px solid rgba(255,255,255,0.12); background: rgba(255,255,255,0.02); color:#fff; padding: 8px 10px; font-weight:600; }
    .btn:hover, .btn:focus-visible { background: rgba(255,255,255,0.06); outline:none; box-shadow: 0 0 0 2px rgba(10,90,255,0.45); }
    .content { flex:1; }
    .container { margin-inline:auto; max-width: 88rem; padding: 24px 16px; }
    @media (min-width: 768px){ .container { padding: 32px; } }
    iframe { width:100%; height: 70vh; border: 1px solid rgba(255,255,255,0.12); border-radius: 16px; background:#111318; }
  </style>
</head>
<body>
  <main class="shell bg-[#0B0B0F] text-white">
    <div class="flex">
      <aside class="sidebar" role="navigation" aria-label="Sidebar">
        <div class="navwrap">
          <nav class="nav">
            <ul class="navlist">
              <li class="brand-item">
                <div class="brandrow">
                  <div class="brandbox" aria-label="Techpulse mark">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 13l4-4 3 7 4-12 4 12 3-3"/></svg>
                  </div>
                </div>
              </li>
              <li aria-hidden="true"><div class="divider"></div></li>
              <li>
                <a href="/dashboard/" id="nav-synth">
                  <span class="ico"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="14" rx="2" ry="2"/><path d="M7 8h10M7 12h8"/></svg></span>
                  <span class="label">Synth</span>
                </a>
              </li>
              <li>
                <a href="/chat/" id="nav-chat" aria-current="page">
                  <span class="ico"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a4 4 0 0 1-4 4H7l-4 4V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z"/></svg></span>
                  <span class="label">Chat</span>
                  <span aria-hidden="true" class="activebar"></span>
                </a>
              </li>
              <li aria-hidden="true"><div class="divider"></div></li>
              <li>
                <a href="#" id="nav-edu">
                  <span class="ico"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10L12 4 2 10l10 6 10-6z"/><path d="M6 12v5a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-5"/></svg></span>
                  <span class="label">Education</span>
                </a>
              </li>
              <li>
                <a href="#" id="nav-billing">
                  <span class="ico"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="5" width="20" height="14" rx="2"/><path d="M2 10h20"/></svg></span>
                  <span class="label">Billing</span>
                </a>
              </li>
            </ul>
          </nav>
        </div>
        <div class="divider" aria-hidden="true"></div>
        <div class="sb-bottom">
          <div class="profile">
            <div class="row">
              <div id="avatar" class="avatar" aria-hidden="true">TP</div>
              <div>
                <div id="prof-name" style="font-weight:600;">User</div>
                <div id="prof-email" class="email">user@example.com</div>
              </div>
            </div>
            <div class="btns">
              <button class="btn" type="button" onclick="window.location.href='/dashboard/'">Account</button>
              <button id="logoutBtn" class="btn danger" type="button">Log out</button>
            </div>
          </div>
        </div>
      </aside>

      <section class="content">
        <div class="container">
          <h1 style="margin:0 0 12px;">Community Chat</h1>
          <div class="card" style="border:1px solid rgba(255,255,255,0.08); background: rgba(255,255,255,0.03); border-radius: 16px; padding: 0; display:flex; flex-direction:column; height:70vh;">
            <div id="roomBar" style="display:flex; gap:8px; padding:10px; border-bottom:1px solid rgba(255,255,255,0.08); align-items:center; flex-wrap:wrap;"></div>
            <div id="chatMessages" style="flex:1; overflow-y:auto; padding:16px; display:flex; flex-direction:column; gap:10px;"></div>
            <div id="typing" class="typing" aria-live="polite"></div>
            <form id="chatForm" style="display:flex; gap:8px; padding:12px; border-top:1px solid rgba(255,255,255,0.08); align-items:center;">
              <input id="fileInput" type="file" style="display:none" />
              <button id="attachBtn" type="button" class="btn secondary" title="Attach" aria-label="Attach file">ðŸ“Ž</button>
              <input id="chatInput" type="text" placeholder="Message #general" autocomplete="off" style="flex:1; background:rgba(255,255,255,0.06); color:#fff; border:1px solid rgba(255,255,255,0.12); border-radius:10px; padding:10px;" />
              <button type="submit" class="btn" style="min-width:88px;">Send</button>
            </form>
          </div>
        </div>
      </section>
    </div>
  </main>
  <!-- New Room Modal -->
  <div id="newRoomModal" class="tp-modal hidden" role="dialog" aria-modal="true" aria-labelledby="newRoomTitle">
    <div class="tp-modal__backdrop" data-close="true"></div>
    <div class="tp-modal__panel" role="document">
      <h2 id="newRoomTitle" style="margin:0 0 8px;">Create channel</h2>
      <p id="newRoomDesc" style="margin:0 0 12px; color:rgba(255,255,255,0.7);">Name your channel. Use letters, numbers, and hyphens only.</p>
      <label for="roomName" style="display:block; font-size:12px; color:rgba(255,255,255,0.7); margin-bottom:6px;">Channel name</label>
      <input id="roomName" class="input" type="text" placeholder="e.g. dev-talk" aria-describedby="slugPreview roomError" />
      <div id="slugPreview" style="margin-top:6px; font-size:12px; color:rgba(255,255,255,0.7);"></div>
      <div id="roomError" role="alert" style="margin-top:8px; color:#ffb4b4; font-size:12px; min-height:16px;"></div>
      <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:16px;">
        <button id="cancelNewRoom" class="btn secondary" type="button">Cancel</button>
        <button id="confirmNewRoom" class="btn" type="button">Create</button>
      </div>
    </div>
  </div>
  <!-- Thread Pane Overlay -->
  <aside id="threadPane" aria-label="Thread" style="display:none; position:fixed; right:0; top:0; height:100vh; width:320px; border-left:1px solid rgba(255,255,255,0.1); background:rgba(17,19,24,0.98); backdrop-filter: blur(6px); padding:12px; z-index:50;">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
      <div id="threadHeader" style="font-weight:600;">Thread</div>
      <button id="threadClose" class="btn secondary" type="button">Close</button>
    </div>
    <div id="threadMessages" style="display:flex; flex-direction:column; gap:8px; overflow-y:auto; height:calc(100% - 96px); padding-right:4px; margin-top:8px;"></div>
    <form id="threadComposer" onsubmit="return false;" style="display:flex; gap:8px; margin-top:8px;">
      <input id="threadInput" class="input" type="text" placeholder="Reply in thread" />
      <button id="threadSend" class="btn" type="button">Send</button>
    </form>
  </aside>
  <script type="module" src="./api/firebase.js"></script>
  <script type="module" src="./chat.js"></script>
</body>
</html>
